---

- name: Check doc directory status
  stat:
    path: /usr/doc/.git
  register: doc_status

- name: Prepare doc directory
  file:
    path: /usr/doc
    state: directory
    owner: root
    group: wheel
    mode: 0755
  become: True
  when: doc_status.stat.exists is false
  
- name: Scan doc directory
  find:
    path: /usr/doc
    file_type: any
    hidden: yes
  register: doc_list
  when: doc_status.stat.exists is false

- name: Clean doc directory
  file:
    path: "{{ item.path }}"
    state: absent
  with_items: "{{ doc_list.files }}"
  loop_control:
    label: "{{ item.path }}"
  become: True
  when: doc_status.stat.exists is false

- name: Install doc
  git:
    repo: 'https://git.freebsd.org/doc.git'
    dest: /usr/doc
    version: main
  become: True
  when: doc_status.stat.exists is false